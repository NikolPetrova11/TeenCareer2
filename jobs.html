<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>–¢—ä—Ä—Å–∞—á–∫–∞ –∑–∞ —Ä–∞–±–æ—Ç–∞</title>
<style>
  body { font-family: Arial; margin: 40px; }
  input { padding: 8px; margin-right: 5px; }
  button { padding: 8px 12px; }
  .job { border-bottom: 1px solid #ccc; padding: 8px 0; }
</style>
</head>
<body>

<h1>üîç –¢—ä—Ä—Å–∏ –æ–±—è–≤–∏</h1>
<input id="role" placeholder="–ü–æ–∑–∏—Ü–∏—è (–Ω–∞–ø—Ä. –ë–∞—Ä–º–∞–Ω)">
<input id="city" placeholder="–ì—Ä–∞–¥ (–Ω–∞–ø—Ä. –í–∞—Ä–Ω–∞)">
<button onclick="searchJobs()">–¢—ä—Ä—Å–∏</button>

<div id="results"></div>

<script>
async function searchJobs() {
  const role = document.getElementById('role').value;
  const city = document.getElementById('city').value;
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = "‚è≥ –¢—ä—Ä—Å–µ–Ω–µ...";

  // CORS bypass —á—Ä–µ–∑ AllOrigins API
  const url = `https://www.zaplata.bg/?q=${encodeURIComponent(role)}&l=${encodeURIComponent(city)}`;
  const proxy = `https://api.codetabs.com/v1/proxy/?quest=${encodeURIComponent(url)}`;


  try {
    const res = await fetch(proxy);
    if (!res.ok) throw new Error("HTTP " + res.status);
    const html = await res.text();

    // –°—ä–∑–¥–∞–≤–∞–º–µ –≤—Ä–µ–º–µ–Ω–µ–Ω DOM –æ—Ç —Ç–µ–∫—Å—Ç–∞
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // –í–∑–µ–º–∞–º–µ –≤—Å–∏—á–∫–∏ –æ–±—è–≤–∏
    const jobs = doc.querySelectorAll('.grid .title a');
    if (jobs.length === 0) {
      resultsDiv.innerHTML = "‚ùå –ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –æ–±—è–≤–∏.";
      return;
    }

    resultsDiv.innerHTML = `<p>–ù–∞–º–µ—Ä–µ–Ω–∏: ${jobs.length}</p>`;
    jobs.forEach(job => {
      const link = job.href;
      const title = job.textContent.trim();
      resultsDiv.innerHTML += `<div class="job"><a href="${link}" target="_blank">${title}</a></div>`;
    });

  } catch (err) {
    resultsDiv.innerHTML = `‚ö†Ô∏è –ì—Ä–µ—à–∫–∞: ${err.message}`;
  }
}
</script>
</body>
</html>
